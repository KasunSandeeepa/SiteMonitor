<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SiteMonitor Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            margin: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #121212;
            color: #fff;
        }
        header {
            padding: 20px 40px;
            background-color: #1e1e2f;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #2c2c3c;
        }
        header h1 {
            color: #4caf50;
        }
        .stats {
            display: flex;
            gap: 30px;
        }
        .stat-card {
            background-color: #1e1e2f;
            padding: 15px 25px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.4);
        }
        .stat-card h2 {
            margin: 5px 0;
            font-size: 20px;
        }
        .stat-card p {
            margin: 0;
            color: #aaa;
            font-size: 14px;
        }
        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            padding: 30px 40px;
        }
        .site-container {
            background-color: #1e1e2f;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.4);
        }
        .site-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        select {
            padding: 5px 10px;
            border-radius: 5px;
            border: none;
            background-color: #2c2c3c;
            color: #fff;
            font-size: 14px;
        }
        canvas {
            background-color: #121212;
        }
    </style>
</head>
<body>
    <header>
        <h1>SiteMonitor</h1>
        <div class="stats">
            <div class="stat-card">
                <h2>10</h2>
                <p>Websites Monitored</p>
            </div>
            <div class="stat-card">
                <h2>1.2s</h2>
                <p>Average TTFB</p>
            </div>
            <div class="stat-card">
                <h2>98.5%</h2>
                <p>Uptime</p>
            </div>
        </div>
    </header>

    <div class="charts-container" id="charts-container"></div>

    <script>
        const websites = [
            "https://www.google.com",
            "https://www.youtube.com",
            "https://www.facebook.com",
            "https://www.instagram.com",
            "https://chat.openai.com",
            "https://www.x.com",
            "https://www.reddit.com",
            "https://www.whatsapp.com",
            "https://www.bing.com",
            "https://www.wikipedia.org"
        ];

        const container = document.getElementById("charts-container");
        const chartObjects = {};

        websites.forEach(site => {
            const siteId = site.replace(/https:\/\/(www\.)?/, '').replace(/\./g, '-');

            const div = document.createElement('div');
            div.className = 'site-container';
            div.innerHTML = `
                <div class="site-header">
                    <h2>${site.replace('https://www.', '')}</h2>
                    <select id="select-${siteId}">
                        <option value="daily">Daily</option>
                        <option value="weekly">Weekly</option>
                        <option value="monthly">Monthly</option>
                    </select>
                </div>
                <canvas id="chart-${siteId}" width="500" height="250"></canvas>
            `;
            container.appendChild(div);

            const ctx = document.getElementById(`chart-${siteId}`).getContext('2d');
            chartObjects[site] = new Chart(ctx, {
                type: 'line',
                data: { labels: [], datasets: [{ label: 'TTFB (s)', data: [], borderWidth: 2, fill: false, borderColor: '#4caf50', tension: 0.3 }] },
                options: { 
                    responsive: true, 
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true, ticks: { color: '#fff' } },
                        x: { ticks: { color: '#fff' } }
                    }
                }
            });

            document.getElementById(`select-${siteId}`).addEventListener('change', () => {
                updateChart(site);
            });
        });

        async function updateChart(site) {
            const siteId = site.replace(/https:\/\/(www\.)?/, '').replace(/\./g, '-');
            const type = document.getElementById(`select-${siteId}`).value;
            const endpoint = `/api/${type}`;
            const data = await fetch(endpoint).then(res => res.json());

            let labels = [];
            let values = [];

            if (type === 'daily') {
                labels = [...Array(24).keys()].map(h => h.toString());
                values = Array(24).fill(null);
                data[site].forEach(d => { values[parseInt(d.hour)] = d.avg_ttfb; });
            } else if (type === 'weekly') {
                labels = Object.keys(data[site] || []);
                values = labels.map(day => {
                    const am = data[site][day]?.AM || 0;
                    const pm = data[site][day]?.PM || 0;
                    return (am + pm) / 2;
                });
            } else if (type === 'monthly') {
                labels = data[site].map(d => d.day);
                values = data[site].map(d => d.avg_ttfb);
            }

            chartObjects[site].data.labels = labels;
            chartObjects[site].data.datasets[0].data = values;
            chartObjects[site].update();
        }

        websites.forEach(site => updateChart(site));

        setInterval(() => {
            websites.forEach(site => updateChart(site));
        }, 5 * 60 * 1000);
    </script>
</body>
</html>
